"use strict";(()=>{var k={showAllSuggestions:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,updateOnSelect:!1,highlightTyped:!1,fullWidth:!1,fixed:!1,fuzzy:!1,startsWith:!1,activeClasses:["bg-primary","text-white"],labelField:"label",valueField:"value",searchFields:["label"],queryParam:"query",items:[],source:null,hiddenInput:!1,hiddenValue:"",datalist:"",server:"",serverMethod:"GET",serverParams:{},serverDataKey:"data",fetchOptions:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(r,e,t)=>e,onSelectItem:(r,e)=>{},onServerResponse:(r,e)=>r.json(),onChange:(r,e)=>{}},O="is-loading",T="is-active",f="show",p="next",g="prev",_=new WeakMap,D=0,v=0;function B(r,e=300){let t;return(...i)=>{clearTimeout(t),t=setTimeout(()=>{r.apply(this,i)},e)}}function G(r){return r.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function b(r){return r?G(r.toString()).toLowerCase():""}function $(r,e){if(r.indexOf(e)>=0)return!0;let t=0;for(let i=0;i<e.length;i++){let s=e[i];if(s!=" "&&(t=r.indexOf(s,t)+1,t<=0))return!1}return!0}function M(r,e){return r.parentNode.insertBefore(e,r.nextSibling)}function J(r){var e=document.createElement("textarea");return e.innerHTML=r,e.value}function I(r,e){for(let[t,i]of Object.entries(e))r.setAttribute(t,i)}var E=class{constructor(e,t={}){if(!(e instanceof HTMLElement)){console.error("Invalid element",e);return}_.set(e,this),D++,v++,this._searchInput=e,this._configure(t),this._preventInput=!1,this._keyboardNavigation=!1,this._searchFunc=B(()=>{this._loadFromServer(!0)},this._config.debounceTime),this._configureSearchInput(),this._configureDropElement(),this._config.fixed&&(document.addEventListener("scroll",this,!0),window.addEventListener("resize",this)),this.handleEvent=i=>{this._handleEvent(i)},this._searchInput.addEventListener("focus",this),this._searchInput.addEventListener("change",this),this._searchInput.addEventListener("blur",this),this._searchInput.addEventListener("input",this),this._searchInput.addEventListener("keydown",this),this._dropElement.addEventListener("mousemove",this),this._fetchData()}static init(e="input.autocomplete",t={}){document.querySelectorAll(e).forEach(s=>{this.getOrCreateInstance(s,t)})}static getInstance(e){return _.has(e)?_.get(e):null}static getOrCreateInstance(e,t={}){return this.getInstance(e)||new this(e,t)}dispose(){v--,this._searchInput.removeEventListener("focus",this),this._searchInput.removeEventListener("change",this),this._searchInput.removeEventListener("blur",this),this._searchInput.removeEventListener("input",this),this._searchInput.removeEventListener("keydown",this),this._dropElement.removeEventListener("mousemove",this),this._config.fixed&&v<=0&&(document.removeEventListener("scroll",this,!0),window.removeEventListener("resize",this)),this._dropElement.parentElement.removeChild(this._dropElement),_.delete(this._searchInput)}handleEvent(e){this._handleEvent(e)}_handleEvent(e){["scroll","resize"].includes(e.type)?(this._timer&&window.cancelAnimationFrame(this._timer),this._timer=window.requestAnimationFrame(()=>{this[`on${e.type}`](e)})):this[`on${e.type}`](e)}_configure(e={}){this._config=Object.assign({},k);let t={...e,...this._searchInput.dataset},i=s=>["true","false","1","0",!0,!1].includes(s)&&!!JSON.parse(s);for(let[s,o]of Object.entries(k)){if(t[s]===void 0)continue;let n=t[s];switch(typeof o){case"number":this._config[s]=parseInt(n);break;case"boolean":this._config[s]=i(n);break;case"string":this._config[s]=n.toString();break;case"object":if(Array.isArray(o))if(typeof n=="string"){let a=n.includes("|")?"|":",";this._config[s]=n.split(a)}else this._config[s]=n;else this._config[s]=typeof n=="string"?JSON.parse(n):n;break;case"function":this._config[s]=typeof n=="string"?window[n]:n;break;default:this._config[s]=n;break}}}_configureSearchInput(){this._searchInput.autocomplete="field-"+Date.now(),this._searchInput.spellcheck=!1,I(this._searchInput,{"aria-auto-complete":"list","aria-has-popup":"menu","aria-expanded":"false",role:"combobox"}),this._hiddenInput=null,this._config.hiddenInput&&(this._hiddenInput=document.createElement("input"),this._hiddenInput.type="hidden",this._hiddenInput.value=this._config.hiddenValue,this._hiddenInput.name=this._searchInput.name,this._searchInput.name="_"+this._searchInput.name,M(this._searchInput,this._hiddenInput))}_configureDropElement(){this._dropElement=document.createElement("ul"),this._dropElement.id="ac-menu-"+D,this._dropElement.setAttribute("role","menu"),this._dropElement.classList.add("dropdown-menu","autocomplete-menu","p-0"),this._dropElement.style.maxHeight="280px",this._config.fullWidth||(this._dropElement.style.maxWidth="360px"),this._config.fixed&&(this._dropElement.style.position="fixed"),this._dropElement.style.overflowY="auto",this._dropElement.style.overscrollBehavior="contain",this._dropElement.style.textAlign="unset",M(this._searchInput,this._dropElement),this._searchInput.setAttribute("aria-controls",this._dropElement.id)}oninput(e){this._preventInput||(this._hiddenInput&&(this._hiddenInput.value=null),this.showOrSearch())}onchange(e){let t=this._searchInput.value,i=Object.values(this._items).find(s=>s.label===t);this._config.onChange(i,this)}onblur(e){this.hideSuggestions()}onfocus(e){this.showOrSearch()}onkeydown(e){switch(e.keyCode||e.key){case 13:case"Enter":if(this.isDropdownVisible()){e.preventDefault();let i=this.getSelection();i&&i.click()}break;case 38:case"ArrowUp":e.preventDefault(),this._keyboardNavigation=!0,this._moveSelection(g);break;case 40:case"ArrowDown":e.preventDefault(),this._keyboardNavigation=!0,this.isDropdownVisible()?this._moveSelection(p):this.showOrSearch(!1);break;case 27:case"Escape":this.isDropdownVisible()&&(this._searchInput.focus(),this.hideSuggestions());break}}onmousemove(e){this._keyboardNavigation=!1}onscroll(e){this._positionMenu()}onresize(e){this._positionMenu()}getConfig(e=null){return e!==null?this._config[e]:this._config}setConfig(e,t){this._config[e]=t}setData(e){this._items={},this._addItems(e)}enable(){this._searchInput.setAttribute("disabled","")}disable(){this._searchInput.removeAttribute("disabled")}isDisabled(){return this._searchInput.hasAttribute("disabled")||this._searchInput.disabled||this._searchInput.hasAttribute("readonly")}isDropdownVisible(){return this._dropElement.classList.contains(f)}getSelection(){return this._dropElement.querySelector("a."+T)}removeSelection(){let e=this.getSelection();e&&e.classList.remove(...this._activeClasses())}_activeClasses(){return[...this._config.activeClasses,T]}_isItemEnabled(e){if(e.style.display==="none")return!1;let t=e.firstElementChild;return t.tagName==="A"&&!t.classList.contains("disabled")}_moveSelection(e=p,t=null){let i=this.getSelection();if(i){let s=e===p?"nextSibling":"previousSibling";t=i.parentNode;do t=t[s];while(t&&!this._isItemEnabled(t));t?(i.classList.remove(...this._activeClasses()),e===g?t.parentNode.scrollTop=t.offsetTop-t.parentNode.offsetTop:t.offsetTop>t.parentNode.offsetHeight-t.offsetHeight&&(t.parentNode.scrollTop+=t.offsetHeight)):i&&(t=i.parentElement)}else{if(e===g)return t;if(!t)for(t=this._dropElement.firstChild;t&&!this._isItemEnabled(t);)t=t.nextSibling}if(t){let s=t.querySelector("a");s.classList.add(...this._activeClasses()),this._searchInput.setAttribute("aria-activedescendant",s.id),this._config.updateOnSelect&&(this._searchInput.value=s.dataset.label)}else this._searchInput.setAttribute("aria-activedescendant","");return t}_shouldShow(){return this.isDisabled()?!1:this._searchInput.value.length>=this._config.suggestionsThreshold}showOrSearch(e=!0){if(e&&!this._shouldShow()){this.hideSuggestions();return}this._config.liveServer?this._searchFunc():this._config.source?this._config.source(this._searchInput.value,t=>{this.setData(t),this._showSuggestions()}):this._showSuggestions()}_createGroup(e){let t=document.createElement("li");t.setAttribute("role","presentation");let i=document.createElement("span");return t.append(i),i.classList.add("dropdown-header","text-truncate"),i.innerHTML=e,t}_createItem(e,t){let i=t.label;if(this._config.highlightTyped){let n=b(i).indexOf(e);i=i.substring(0,n)+`<mark>${i.substring(n,n+e.length)}</mark>`+i.substring(n+e.length,i.length)}i=this._config.onRenderItem(t,i,this);let s=document.createElement("li");s.setAttribute("role","presentation");let o=document.createElement("a");if(s.append(o),o.id=this._dropElement.id+"-"+this._dropElement.children.length,o.classList.add("dropdown-item","text-truncate"),o.setAttribute("data-value",t.value),o.setAttribute("data-label",t.label),o.setAttribute("tabindex","-1"),o.setAttribute("role","menuitem"),o.setAttribute("href","#"),o.innerHTML=i,t.data)for(let[n,a]of Object.entries(t.data))o.dataset[n]=a;return o.addEventListener("mouseenter",n=>{this._keyboardNavigation||(this.removeSelection(),s.querySelector("a").classList.add(...this._activeClasses()))}),o.addEventListener("mousedown",n=>{n.preventDefault()}),o.addEventListener("click",n=>{n.preventDefault(),this._preventInput=!0,this._searchInput.value=J(t.label),this._hiddenInput&&(this._hiddenInput.value=t.value),this._config.onSelectItem(t,this),this.hideSuggestions(),this._preventInput=!1}),s}_showSuggestions(){if(document.activeElement!=this._searchInput)return;let e=b(this._searchInput.value);this._dropElement.innerHTML="";let t=Object.keys(this._items),i=0,s=null,o=[];for(let n=0;n<t.length;n++){let a=t[n],h=this._items[a],c=this._config.showAllSuggestions||e.length===0,l=e.length==0&&this._config.suggestionsThreshold===0;!c&&e.length>0&&this._config.searchFields.forEach(d=>{let u=b(h[d]),m=!1;if(this._config.fuzzy)m=$(u,e);else{let A=u.indexOf(e);m=this._config.startsWith?A===0:A>=0}m&&(l=!0)});let R=l||e.length===0;if(c||l){if(i++,h.group&&!o.includes(h.group)){let u=this._createGroup(h.group);this._dropElement.appendChild(u),o.push(h.group)}let d=this._createItem(e,h);if(!s&&R&&(s=d),this._dropElement.appendChild(d),this._config.maximumItems>0&&i>=this._config.maximumItems)break}}if(s&&this._config.autoselectFirst&&(this.removeSelection(),this._moveSelection(p,s)),i===0)if(this._config.notFoundMessage){let n=document.createElement("li");n.setAttribute("role","presentation"),n.innerHTML=`<span class="dropdown-item">${this._config.notFoundMessage}</span>`,this._dropElement.appendChild(n),this._showDropdown()}else this.hideSuggestions();else this._showDropdown()}_showDropdown(){this._dropElement.classList.add(f),I(this._searchInput,{"aria-expanded":"true"}),this._positionMenu()}toggleSuggestions(e=!0){this._dropElement.classList.contains(f)?this.hideSuggestions():this.showOrSearch(e)}hideSuggestions(){this._dropElement.classList.remove(f),I(this._searchInput,{"aria-expanded":"false"}),this.removeSelection()}getInput(){return this._searchInput}getDropMenu(){return this._dropElement}_positionMenu(){let e=window.getComputedStyle(this._searchInput),t=this._searchInput.getBoundingClientRect(),i=e.direction==="rtl",s=this._config.fullWidth,o=this._config.fixed,n=null,a=null;o&&(n=t.x,a=t.y+t.height,i&&!s&&(n-=this._dropElement.offsetWidth-t.width)),this._dropElement.style.transform="unset",s&&(this._dropElement.style.width=this._searchInput.offsetWidth+"px"),n!==null&&(this._dropElement.style.left=n+"px"),a!==null&&(this._dropElement.style.top=a+"px");let h=this._dropElement.getBoundingClientRect(),c=window.innerHeight;if(h.y+h.height>c){let l=s?t.height+4:t.height;this._dropElement.style.transform="translateY(calc(-100.1% - "+l+"px))"}}_fetchData(){this._items={},this._addItems(this._config.items);let e=this._config.datalist;if(e){let t=document.querySelector(`#${e}`);if(t){let i=Array.from(t.children).map(s=>{let o=s.getAttribute("value")??s.innerHTML.toLowerCase(),n=s.innerHTML;return{value:o,label:n}});this._addItems(i)}else console.error(`Datalist not found ${e}`)}this._setHiddenVal(),this._config.server&&!this._config.liveServer&&this._loadFromServer()}_setHiddenVal(){if(this._config.hiddenInput&&!this._config.hiddenValue)for(let[e,t]of Object.entries(this._items))t.label==this._searchInput.value&&(this._hiddenInput.value=e)}_addItems(e){let t=Object.keys(e);for(let i=0;i<t.length;i++){let s=t[i],o=e[s];if(o.group&&o.items){o.items.forEach(h=>h.group=o.group),this._addItems(o.items);continue}let n=typeof o=="string"?o:o.label,a=typeof o!="object"?{}:o;a.label=o[this._config.labelField]??n,a.value=o[this._config.valueField]??s,a.label&&(this._items[a.value]=a)}}_loadFromServer(e=!1){this._abortController&&this._abortController.abort(),this._abortController=new AbortController;let t=this._searchInput.dataset.serverParams||{};typeof t=="string"&&(t=JSON.parse(t));let i=Object.assign({},this._config.serverParams,t);if(i[this._config.queryParam]=this._searchInput.value,this._config.noCache&&(i.t=Date.now()),i.related){let a=document.getElementById(i.related);if(a){i.related=a.value;let h=a.getAttribute("name");h&&(i[h]=a.value)}}let s=new URLSearchParams(i),o=this._config.server,n=Object.assign(this._config.fetchOptions,{method:this._config.serverMethod||"GET",signal:this._abortController.signal});n.method==="POST"?n.body=s:o+="?"+s.toString(),this._searchInput.classList.add(O),fetch(o,n).then(a=>this._config.onServerResponse(a,this)).then(a=>{let h=a[this._config.serverDataKey]||a;this.setData(h),this._setHiddenVal(),this._abortController=null,e&&this._showSuggestions()}).catch(a=>{a.name!=="AbortError"&&console.error(a)}).finally(a=>{this._searchInput.classList.remove(O)})}},N=E;var y=r=>typeof r=="string";var S=r=>r.split(".").reduce((e,t)=>e[t],window);var F=r=>{y(r)&&(r=r[0]=="{"?JSON.parse(r):S(r));for(let[e,t]of Object.entries(r))if(t&&typeof t=="object"){let i=t.__fn;y(i)?r[e]=S(i):F(t)}return r},H=F;var P=r=>{let e=r;do{if(e.nextSibling){r.parsedCallback();return}e=e.parentNode}while(e);setTimeout(()=>{P(r)})},V=P;var w,x=class extends HTMLElement{connectedCallback(){w&&clearTimeout(w),V(this)}disconnectedCallback(){this.disconnected(),w=setTimeout(()=>{this.destroyed(),this.config=null},1e3)}parsedCallback(){this.config||(this.config=H(this.dataset.config||{}),this.created()),this.connected()}created(){}destroyed(){}connected(){}disconnected(){}},z=x;var q=(r,e)=>{e=typeof e=="string"?[e]:e,e.forEach(t=>{r.querySelectorAll(t).forEach(i=>{i.remove()})})};var L=class extends z{get el(){return this.querySelector("input")}get value(){return this.el.value}created(){q(this,"div.dropdown"),this.config=Object.assign({hiddenInput:!0},this.config),this.lib=new N(this.el,this.config)}destroyed(){this.lib.dispose(),this.lib=null}},C=L;var W=customElements,j=(r,e)=>{W.get(r)||W.define(r,e)};j("bs-autocomplete",C);var ue=C;})();
