"use strict";(()=>{var I=Object.defineProperty;var H=(t,s,e)=>s in t?I(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e;var w=(t,s,e)=>H(t,typeof s!="symbol"?s+"":s,e);var h=t=>typeof t=="string";var c=t=>t.split(".").reduce((s,e)=>s[e],window);var x=t=>{h(t)&&(t=t[0]=="{"?JSON.parse(t):c(t));for(let[s,e]of Object.entries(t))if(e&&typeof e=="object"){let r=e.__fn;h(r)?t[s]=c(r):x(e)}return t},d=x;var f=t=>t?(t[0]!="{"&&t.includes(":")&&(t=`{${t.replace(/([\w]*)\s*:\s*([\w"'\[\]]*)/,(s,e,r)=>`"${e}":${r.replace(/'/g,'"')}`)}}`),t[0]=="{"?JSON.parse(t):c(t)):{};var R=t=>{let s=t;do{if(s.nextSibling){t.parsedCallback();return}s=s.parentNode}while(s);setTimeout(()=>{t.parsedCallback()})},T=R;var u="__fe_id";window[u]=window[u]||0;var p=new Map,g=class extends HTMLElement{constructor(){super(),this.id=this.id||`fe-${window[u]++}`;let s=p.get(this.id);s?s!=this.innerHTML&&(this.innerHTML=s):p.set(this.id,this.innerHTML)}connectedCallback(){this._t&&clearTimeout(this._t),T(this)}disconnectedCallback(){this.disconnected(),this._t=setTimeout(()=>{this.destroyed(),this.config=null,document.getElementById(this.id)||p.delete(this.id)},1e3)}parsedCallback(){this.config||(this.config=d(f(this.dataset.config)),this.created()),this.connected()}created(){}destroyed(){}connected(){}disconnected(){}},C=g;var v=new window.IntersectionObserver((t,s)=>{t.filter(e=>e.isIntersecting).forEach(e=>{let r=e.target;s.unobserve(r),r.doCreate()})}),m=class extends C{constructor(){super(...arguments);w(this,"handleEvent",e=>{this.trackFocus(e),this[`$${e.type}`](e)})}get events(){return[]}parsedCallback(){this.lazy=this.hasAttribute("lazy"),this.config||(this.lazy?v.observe(this):this.doCreate()),this.config&&this.connected()}doCreate(){this.config=d(f(this.dataset.config)),this.created()}connectedCallback(){super.connectedCallback(),this.events.forEach(e=>this.addEventListener(e,this))}trackFocus(e){e.type=="focusin"?this.classList.add("has-focus"):e.type=="focusout"&&this.classList.remove("has-focus")}disconnectedCallback(){this.lazy&&this.config&&v.unobserve(this),this.events.forEach(e=>this.removeEventListener(e,this)),super.disconnectedCallback()}},P=m;var E=t=>document.createElement(t);var S=new Map,L=(t,s={},e={})=>{t instanceof URL&&(t=t.toString());let r={method:"GET"};if(!e.signal){let i=S.get(t);i&&i.abort(),i=new AbortController,S.set(t,i),r.signal=i.signal}let o=Object.assign(r,e),n=o.headers||{};t.includes("https://cdn.jsdelivr.net")||(n["X-Requested-With"]="XMLHttpRequest"),o.headers=n;let a=new URLSearchParams(s);return o.method==="POST"&&!o.body?(o.body=a,o.headers["Content-Type"]="application/x-www-form-urlencoded"):t+="?"+a.toString(),fetch(t,o)};var k=(t,s={},e={})=>{let r=e.headers||{};return r.Accept="application/json",e.body&&typeof e.body!="string"&&e.method=="POST"&&(r["Content-Type"]="application/json",e.body=JSON.stringify(e.body)),e.headers=r,L(t,s,e).then(o=>o.text().then(n=>{let a,i=!o.ok;try{a=n&&JSON.parse(n)}catch{i=!0,a={message:"Invalid JSON response"}}if(i){let l=a&&a.message||o.statusText;return Promise.reject(l)}return a}))};var O=t=>{let s={};return t.forEach((e,r)=>{if(!Reflect.has(s,r)){s[r]=e;return}Array.isArray(s[r])||(s[r]=[s[r]]),s[r].push(e)}),s};function _(t,s={}){let e=customElements.get("pop-notify");e&&e.notify(t,s)}function M(t,s,e){k(s,e,{headers:{"X-Progressive":1},method:"POST"}).then(r=>{if(r===null){_("Invalid handler");return}if(r.message){let i=r.message_options||{};_(r.message,i)}let o=parseInt(r.progress_total),n=parseInt(r.progress_step),a=o&&n>=o;if(r.finished||a){t.setProgress(100),r.label&&t.setText(r.label),r.reload?window.location.reload():r.url?window.location.href=r.url:r.label||t.clearProgress();return}if(Object.assign(e,r),n&&o){let i=Math.round(n/o*100);t.setProgress(i)}else{t.dataset.hideTextProgress="1";let i=n*10;i>50&&(i=25+n*5),i>75&&(i=50+n*2.5),n>90&&(i=n),i>90&&(i=90),t.setProgress(i)}M(t,s,e)}).catch(r=>{t.clearProgress(),t.setText("Error"),console.error(r)})}var b=class extends P{get events(){return["click"]}get el(){return this.querySelector("button,a")}get progress(){return this.querySelector("div")}created(){this.style.display="inline-block",this.style.position="relative"}$click(s){s.preventDefault();let e=this.el;if(e.classList.contains("disabled")||e.hasAttribute("disabled"))return;let r=this.dataset.confirmMessage;if(r&&!confirm(r))return;let o=e.dataset.url;o||(o=e.dataset.href||e.getAttribute("href"));let n=e.closest("form");e.hasAttribute("form")&&(n=document.querySelector(`${e.getAttribute("form")}`));let a={};n&&(o||(o=n.getAttribute("action")),a=O(new FormData(n))),e instanceof HTMLButtonElement&&(a[e.getAttribute("name")||"_action"]=e.value||e.innerText),a.progress_step=0;let i=this.dataset.progressTotal;typeof i<"u"&&i!==null&&(a.progress_total=i),e.classList.add("disabled"),e.setAttribute("disabled","");let l=E("div");Object.assign(l.style,{position:"absolute",width:0,top:0,bottom:0,left:0,background:"#000",borderRadius:window.getComputedStyle(e).borderRadius,zIndex:"-1",transition:"width 0.1s ease"}),this.appendChild(l),this.dataset.waitMessage?this.setText(this.dataset.waitMessage):this.setProgress(0),M(this,o,a)}setProgress(s){this.dataset.hideTextProgress||this.setText(s+"%"),this.el.style.opacity="0.5",this.progress.style.width=`${s}%`}clearProgress(){this.restoreText(),this.el.style.opacity="unset",this.progress.remove(),this.el.classList.remove("disabled"),this.el.removeAttribute("disabled")}setText(s){let e=this.el;e.style.width=`${e.getBoundingClientRect().width}px`;let r=e.querySelector("span")||e;this.original||(this.original=r.innerHTML),r.innerHTML=s}restoreText(){this.original&&this.setText(this.original)}},y=b;var A=customElements,$=(t,s)=>{A.get(t)||A.define(t,s)};$("progress-button",y);var ue=y;})();
