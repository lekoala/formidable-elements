(()=>{var h=e=>typeof e=="string";var c=e=>e.split(".").reduce((t,s)=>t[s],window);var w=e=>{h(e)&&(e=e[0]=="{"?JSON.parse(e):c(e));for(let[t,s]of Object.entries(e))if(s&&typeof s=="object"){let r=s.__fn;h(r)?e[t]=c(r):w(s)}return e},d=w;var f=e=>e?(e[0]!="{"&&e.includes(":")&&(e=`{${e.replace(/([\w]*)\s*:\s*([\w"'\[\]]*)/g,(t,s,r)=>`"${s}":${r.replace(/'/g,'"')}`)}}`),e[0]=="{"?JSON.parse(e):c(e)):{};var $=e=>{let t=e;do{if(t.nextSibling){e.parsedCallback();return}t=t.parentNode}while(t);setTimeout(()=>{e.parsedCallback()})},x=$;var u="__fe_id";window[u]=window[u]||0;var p=new Map,g=class extends HTMLElement{_restoreContent(){this.id=this.id||`fe-${window[u]++}`;let t=p.get(this.id);t?t!==this.innerHTML&&(this.innerHTML=t):p.set(this.id,this.innerHTML)}connectedCallback(){this._t&&clearTimeout(this._t),x(this)}disconnectedCallback(){this.disconnected(),this._t=setTimeout(()=>{this.destroyed(),this.config=null,document.getElementById(this.id)||p.delete(this.id)},1e3)}parsedCallback(){this.config||(this._restoreContent(),this.config=d(f(this.dataset.config)),this.created()),this.connected()}created(){}destroyed(){}connected(){}disconnected(){}},T=g;var C=new window.IntersectionObserver((e,t)=>{for(let s of e.filter(r=>r.isIntersecting)){let r=s.target;t.unobserve(r),r.doCreate()}}),m=class extends T{get events(){return[]}parsedCallback(){this.lazy=this.hasAttribute("lazy"),this.config||(this.lazy?C.observe(this):this.doCreate()),this.config&&this.connected()}doCreate(){this.config=d(f(this.dataset.config)),this.created()}connectedCallback(){this.handleEvent=t=>{this._handleEvent(t)},super.connectedCallback();for(let t of this.events)this.addEventListener(t,this)}trackFocus(t){t.type==="focusin"?this.classList.add("has-focus"):t.type==="focusout"&&this.classList.remove("has-focus")}_handleEvent(t){this.trackFocus(t),this[`$${t.type}`](t)}disconnectedCallback(){this.lazy&&this.config&&C.unobserve(this);for(let t of this.events)this.removeEventListener(t,this);super.disconnectedCallback()}},v=m;var P=e=>document.createElement(e);var _=new Map,S=(e,t={},s={})=>{e instanceof URL&&(e=e.toString());let r={method:"GET"};if(!s.signal){let i=_.get(e);i&&i.abort(),i=new AbortController,_.set(e,i),r.signal=i.signal}let o=Object.assign(r,s),n=o.headers||{};e.includes("https://cdn.jsdelivr.net")||(n["X-Requested-With"]="XMLHttpRequest"),o.headers=n;let a=new URLSearchParams(t);return o.method==="POST"&&!o.body?(o.body=a,o.headers["Content-Type"]="application/x-www-form-urlencoded"):e+="?"+a.toString(),fetch(e,o)};var E=(e,t={},s={})=>{let r=s.headers||{};return r.Accept="application/json",s.body&&typeof s.body!="string"&&s.method=="POST"&&(r["Content-Type"]="application/json",s.body=JSON.stringify(s.body)),s.headers=r,S(e,t,s).then(o=>o.text().then(n=>{let a,i=!o.ok;try{a=n&&JSON.parse(n)}catch{i=!0,a={message:"Invalid JSON response"}}if(i){let l=a&&a.message||o.statusText;return Promise.reject(l)}return a}))};var L=e=>{let t={};return e.forEach((s,r)=>{if(!Reflect.has(t,r)){t[r]=s;return}Array.isArray(t[r])||(t[r]=[t[r]]),t[r].push(s)}),t};function k(e,t={}){let s=customElements.get("pop-notify");s&&s.notify(e,t)}function O(e,t,s){E(t,s,{headers:{"X-Progressive":1},method:"POST"}).then(r=>{if(r===null){k("Invalid handler");return}if(r.message){let i=r.message_options||{};k(r.message,i)}let o=parseInt(r.progress_total),n=parseInt(r.progress_step),a=o&&n>=o;if(r.finished||a){e.setProgress(100),r.label&&e.setText(r.label),r.reload?window.location.reload():r.url?window.location.href=r.url:r.label||e.clearProgress();return}if(Object.assign(s,r),n&&o){let i=Math.round(n/o*100);e.setProgress(i)}else{e.dataset.hideTextProgress="1";let i=n*10;i>50&&(i=25+n*5),i>75&&(i=50+n*2.5),n>90&&(i=n),i>90&&(i=90),e.setProgress(i)}O(e,t,s)}).catch(r=>{e.clearProgress(),e.setText("Error"),console.error(r)})}var b=class extends v{get events(){return["click"]}get el(){return this.querySelector("button,a")}get progress(){return this.querySelector("div")}created(){this.style.display="inline-block",this.style.position="relative"}$click(t){t.preventDefault();let s=this.el;if(s.classList.contains("disabled")||s.hasAttribute("disabled"))return;let r=this.dataset.confirmMessage;if(r&&!confirm(r))return;let o=s.dataset.url;o||(o=s.dataset.href||s.getAttribute("href"));let n=s.closest("form");s.hasAttribute("form")&&(n=document.querySelector(`${s.getAttribute("form")}`));let a={};n&&(o||(o=n.getAttribute("action")),a=L(new FormData(n))),s instanceof HTMLButtonElement&&(a[s.getAttribute("name")||"_action"]=s.value||s.innerText),a.progress_step=0;let i=this.dataset.progressTotal;typeof i<"u"&&i!==null&&(a.progress_total=i),s.classList.add("disabled"),s.setAttribute("disabled","");let l=P("div");Object.assign(l.style,{position:"absolute",width:0,top:0,bottom:0,left:0,background:"#000",borderRadius:window.getComputedStyle(s).borderRadius,zIndex:"-1",transition:"width 0.1s ease"}),this.appendChild(l),this.dataset.waitMessage?this.setText(this.dataset.waitMessage):this.setProgress(0),O(this,o,a)}setProgress(t){this.dataset.hideTextProgress||this.setText(t+"%"),this.el.style.opacity="0.5",this.progress.style.width=`${t}%`}clearProgress(){this.restoreText(),this.el.style.opacity="unset",this.progress.remove(),this.el.classList.remove("disabled"),this.el.removeAttribute("disabled")}setText(t){let s=this.el;s.style.width=`${s.getBoundingClientRect().width}px`;let r=s.querySelector("span")||s;this.original||(this.original=r.innerHTML),r.innerHTML=t}restoreText(){this.original&&this.setText(this.original)}},y=b;var M=customElements,A=(e,t)=>{M.get(e)||M.define(e,t)};A("progress-button",y);var ce=y;})();
