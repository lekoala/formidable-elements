"use strict";(()=>{var p=e=>typeof e=="string";var c=e=>e.split(".").reduce((s,t)=>s[t],window);var w=e=>{p(e)&&(e=e[0]=="{"?JSON.parse(e):c(e));for(let[s,t]of Object.entries(e))if(t&&typeof t=="object"){let i=t.__fn;p(i)?e[s]=c(i):w(t)}return e},d=w;var f=e=>e?(e.includes(":")&&e[0]!="{"&&(e=`{${e.replace(/([\w]*)\s*:\s*([\w"'\[\]]*)/,(s,t,i)=>`"${t}":${i.replace(/'/g,'"')}`)}}`),e[0]=="{"?JSON.parse(e):c(e)):{};var $=e=>{let s=e;do{if(s.nextSibling){e.parsedCallback();return}s=s.parentNode}while(s);setTimeout(()=>{e.parsedCallback()})},x=$;var u="__id";window[u]=window[u]||0;var h=new Map,g=class extends HTMLElement{constructor(){super(),this.id=this.id||`ce-${window[u]++}`,h.has(this.id)?this.innerHTML=h.get(this.id):h.set(this.id,this.innerHTML),console.log("created",this.id)}connectedCallback(){this._t&&clearTimeout(this._t),x(this)}disconnectedCallback(){console.log("disco",this.id),this.disconnected(),this._t=setTimeout(()=>{this.destroyed(),this.config=null,document.getElementById(this.id)||h.delete(this.id)},1e3)}parsedCallback(){this.config||(this.config=d(f(this.dataset.config)),this.created()),this.connected()}created(){}destroyed(){}connected(){}disconnected(){}},T=g;var C=new window.IntersectionObserver((e,s)=>{e.filter(t=>t.isIntersecting).forEach(t=>{let i=t.target;s.unobserve(i),i.doCreate()})}),m=class extends T{get events(){return[]}parsedCallback(){this.lazy=this.hasAttribute("lazy"),this.config||(this.lazy?C.observe(this):this.doCreate()),this.config&&this.connected()}doCreate(){this.config=d(f(this.dataset.config)),this.created()}connectedCallback(){super.connectedCallback(),this.events.forEach(s=>this.addEventListener(s,this))}trackFocus(s){s.type=="focusin"?this.classList.add("has-focus"):s.type=="focusout"&&this.classList.remove("has-focus")}handleEvent=s=>{this.trackFocus(s),this[`$${s.type}`](s)};disconnectedCallback(){this.lazy&&this.config&&C.unobserve(this),this.events.forEach(s=>this.removeEventListener(s,this)),super.disconnectedCallback()}},v=m;var P=e=>document.createElement(e);var E=new Map,S=(e,s={},t={})=>{e instanceof URL&&(e=e.toString());let i={method:"GET"};if(!t.signal){let r=E.get(e);r&&r.abort(),r=new AbortController,E.set(e,r),i.signal=r.signal}let o=Object.assign(i,t),n=o.headers||{};e.includes("https://cdn.jsdelivr.net")||(n["X-Requested-With"]="XMLHttpRequest"),o.headers=n;let a=new URLSearchParams(s);return o.method==="POST"&&!o.body?(o.body=a,o.headers["Content-Type"]="application/x-www-form-urlencoded"):e+="?"+a.toString(),fetch(e,o)};var k=(e,s={},t={})=>{let i=t.headers||{};return i.Accept="application/json",t.body&&typeof t.body!="string"&&t.method=="POST"&&(i["Content-Type"]="application/json",t.body=JSON.stringify(t.body)),t.headers=i,S(e,s,t).then(o=>o.text().then(n=>{let a,r=!o.ok;try{a=n&&JSON.parse(n)}catch{r=!0,a={message:"Invalid JSON response"}}if(r){let l=a&&a.message||o.statusText;return Promise.reject(l)}return a}))};var L=e=>{let s={};return e.forEach((t,i)=>{if(!Reflect.has(s,i)){s[i]=t;return}Array.isArray(s[i])||(s[i]=[s[i]]),s[i].push(t)}),s};function O(e,s={}){let t=customElements.get("pop-notify");t&&t.notify(e,s)}function _(e,s,t){k(s,t,{headers:{"X-Progressive":1},method:"POST"}).then(i=>{if(i===null){O("Invalid handler");return}if(i.message){let r=i.message_options||{};O(i.message,r)}let o=parseInt(i.progress_total),n=parseInt(i.progress_step),a=o&&n>=o;if(i.finished||a){e.setProgress(100),i.label&&e.setText(i.label),i.reload?window.location.reload():i.url?window.location.href=i.url:i.label||e.clearProgress();return}if(Object.assign(t,i),n&&o){let r=Math.round(n/o*100);e.setProgress(r)}else{e.dataset.hideTextProgress="1";let r=n*10;r>50&&(r=25+n*5),r>75&&(r=50+n*2.5),n>90&&(r=n),r>90&&(r=90),e.setProgress(r)}_(e,s,t)}).catch(i=>{e.clearProgress(),e.setText("Error"),console.error(i)})}var b=class extends v{get events(){return["click"]}get el(){return this.querySelector("button,a")}get progress(){return this.querySelector("div")}created(){this.style.display="inline-block",this.style.position="relative"}$click(s){s.preventDefault();let t=this.el;if(t.classList.contains("disabled")||t.hasAttribute("disabled"))return;let i=this.dataset.confirmMessage;if(i&&!confirm(i))return;let o=t.dataset.url;o||(o=t.dataset.href||t.getAttribute("href"));let n=t.closest("form");t.hasAttribute("form")&&(n=document.querySelector(`${t.getAttribute("form")}`));let a={};n&&(o||(o=n.getAttribute("action")),a=L(new FormData(n))),t instanceof HTMLButtonElement&&(a[t.getAttribute("name")||"_action"]=t.value||t.innerText),a.progress_step=0;let r=this.dataset.progressTotal;typeof r<"u"&&r!==null&&(a.progress_total=r),t.classList.add("disabled"),t.setAttribute("disabled","");let l=P("div");Object.assign(l.style,{position:"absolute",width:0,top:0,bottom:0,left:0,background:"#000",borderRadius:window.getComputedStyle(t).borderRadius,zIndex:"-1",transition:"width 0.1s ease"}),this.appendChild(l),this.dataset.waitMessage?this.setText(this.dataset.waitMessage):this.setProgress(0),_(this,o,a)}setProgress(s){this.dataset.hideTextProgress||this.setText(s+"%"),this.el.style.opacity="0.5",this.progress.style.width=`${s}%`}clearProgress(){this.restoreText(),this.el.style.opacity="unset",this.progress.remove(),this.el.classList.remove("disabled"),this.el.removeAttribute("disabled")}setText(s){let t=this.el;t.style.width=`${t.getBoundingClientRect().width}px`;let i=t.querySelector("span")||t;this.original||(this.original=i.innerHTML),i.innerHTML=s}restoreText(){this.original&&this.setText(this.original)}},y=b;var A=customElements,M=(e,s)=>{A.get(e)||A.define(e,s)};M("progress-button",y);var ce=y;})();
