"use strict";(()=>{var M="superfile",C="superfile-preview",A="superfile-preview-active",q="superfile-clear",k="superfile-ready",f="superfile-drag",R="superfile-clone";var v=class i{constructor(e){this.inputElement=e,this.holderElement=e.parentElement,this.holderElement.classList.contains(M)||(this.holderElement=this.holderElement.parentElement),this.previewElement=this.holderElement.querySelector("img."+C),this.clearElement=this.holderElement.querySelector("."+q),this.disableResize=!!e.dataset.disableResize,this.maxWidth=e.dataset.maxWidth?parseInt(e.dataset.maxWidth):1024,this.maxHeight=e.dataset.maxHeight?parseInt(e.dataset.maxHeight):1024,this.hideClear=!!e.dataset.hideClear,this.imageRatio=e.dataset.ratio?e.dataset.ratio.split(/\/|:/):null,this.clearElement&&this.hideClear&&(this.clearElement.dataset.originalDisplay=this.clearElement.style.display?this.clearElement.style.display:"block",this.clearElement.style.display="none"),this.previewElement&&this.previewElement.getAttribute("src")&&this.showPreview(),this.inputElement.addEventListener("change",t=>{this.processFiles(()=>{this.showPreview()})}),this.clearElement&&this.clearElement.addEventListener("click",t=>{this.clearPreview()}),this.holderElement.addEventListener("dragleave",t=>{this.onDragleave(t)}),this.holderElement.addEventListener("dragover",t=>{this.onDragover(t)}),this.holderElement.addEventListener("drop",t=>{this.onDrop(t)}),this.holderElement.classList.add(k)}static init(e="input[type=file]"){let t=document.querySelectorAll(e);for(let s=0;s<t.length;s++){let l=t[s],n=new i(l)}}onDrop(e){e.stopPropagation(),e.preventDefault(),this.inputElement.files=e.dataTransfer.files,this.inputElement.dispatchEvent(new Event("change")),this.holderElement.classList.remove(f)}onDragover(e){e.stopPropagation(),e.preventDefault(),this.holderElement.classList.contains(f)||this.holderElement.classList.add(f),e.dataTransfer.dropEffect="copy"}onDragleave(e){e.stopPropagation(),e.preventDefault(),this.holderElement.classList.remove(f)}showPreview(){if(!this.previewElement)return;this.holderElement.classList.add(A),this.clearElement&&this.clearElement.dataset.originalDisplay&&(this.clearElement.style.display=this.clearElement.dataset.originalDisplay);let e=this.previewElement.parentElement;for(let t=0;t<this.inputElement.files.length;t++){let s=this.inputElement.files[t];if(!s.type.match(/image.*/))continue;let l=e.querySelectorAll("."+C)[t];l||(l=this.previewElement.cloneNode(!0),l.classList.add(R),e.appendChild(l)),l.src=URL.createObjectURL(s)}}clearPreview(){if(this.previewElement){this.holderElement.classList.remove(A),this.previewElement.removeAttribute("src"),this.hideClear&&(this.clearElement.style.display="none");let e=this.holderElement.querySelectorAll("."+R);for(let t=0;t<e.length;t++)e[t].parentElement.removeChild(e[t])}this.inputElement.value=null}resizeImage(e,t,s){let l=document.createElement("canvas"),n=0,h=0,o=t.naturalWidth,c=t.naturalHeight,g=o,u=c,r=o,a=c,b=r>this.maxWidth||a>this.maxHeight,E=r/a,d=E,p=!1;if(this.imageRatio&&(d=this.imageRatio[0]/this.imageRatio[1],p=this.imageRatio!==d),!b&&!p){s();return}p&&(E>d?r=a*d:E<d&&(a=r/d),n=(o-r)/2,h=(c-a)/2),r>this.maxWidth&&(a*=this.maxWidth/r,g*=this.maxWidth/r,u*=this.maxWidth/r,r=this.maxWidth),a>this.maxHeight&&(r*=this.maxHeight/a,g*=this.maxHeight/a,u*=this.maxHeight/a,a=this.maxHeight),r=Math.round(r),a=Math.round(a),l.width=r,l.height=a;let m=l.getContext("2d");m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="high",p?m.drawImage(t,n,h,o,c,0,0,g,u):m.drawImage(t,0,0,r,a),m.canvas.toBlob(F=>{this.createProcessedFile(e,F,s)},e.type,1)}handleResizeImage(e,t){if(!e.type.match(/image.*/)){t();return}if(this.disableResize){t();return}let s=new FileReader;s.onload=l=>{let n=new Image;n.onload=()=>{this.resizeImage(e,n,t)},n.onerror=h=>{},n.src=l.target.result},s.onerror=l=>{console.log(l)},s.readAsDataURL(e)}createProcessedFile(e,t,s){let l=new File([t],e.name,{type:e.type,lastModified:Date.now()}),n=new DataTransfer;for(let h=0;h<this.inputElement.files.length;h++){let o=this.inputElement.files[h];o.name===e.name?n.items.add(l):n.items.add(o)}this.inputElement.files=n.files,s()}processFiles(e){let t=this.inputElement.files;if(!t.length){e();return}for(let s=0;s<t.length;s++)this.handleResizeImage(t[s],e)}},H=v;var w=i=>typeof i=="string";var y=i=>i.split(".").reduce((e,t)=>e[t],window);var D=i=>{w(i)&&(i=i[0]=="{"?JSON.parse(i):y(i));for(let[e,t]of Object.entries(i))if(t&&typeof t=="object"){let s=t.__fn;w(s)?i[e]=y(s):D(t)}return i},I=D;var W=i=>{let e=i;do{if(e.nextSibling){i.parsedCallback();return}e=e.parentNode}while(e);setTimeout(()=>{W(i)})},_=W;var x=class extends HTMLElement{connectedCallback(){this._t&&clearTimeout(this._t),_(this)}disconnectedCallback(){this.disconnected(),this._t=setTimeout(()=>{this.destroyed(),this.config=null},1e3)}parsedCallback(){this.config||(this.config=I(this.dataset.config||{}),this.created()),this.connected()}created(){}destroyed(){}connected(){}disconnected(){}},P=x;var L=class extends P{get el(){return this.querySelector("input")}created(){let e=this.el;this.superfile=new H(e)}destroyed(){this.superfile=null}},S=L;var T=customElements,z=(i,e)=>{T.get(i)||T.define(i,e)};z("superfile-input",S);var ie=S;})();
