(()=>{var O="superfile",I="superfile-preview",H="superfile-preview-active",_="superfile-clear",b="superfile-webcam",U="superfile-ready",v="superfile-drag",T="superfile-clone";var y=class s{constructor(e){this.inputElement=e,this.holderElement=e.parentElement,this.holderElement.classList.contains(O)||(this.holderElement=this.holderElement.parentElement),this.previewElement=this.holderElement.querySelector("img."+I),this.clearElement=this.holderElement.querySelector("."+_),this.webcamElement=this.holderElement.querySelector("."+b);let t=e.dataset;this.disableResize=!!t.disableResize,this.maxWidth=t.maxWidth?parseInt(t.maxWidth):1920,this.maxHeight=t.maxHeight?parseInt(t.maxHeight):1920,this.hideClear=!!t.hideClear,this.imageRatio=t.ratio?t.ratio.split(/\/|:/):null,this.quality=t.quality?parseInt(t.quality):1,this.quality>1&&(this.quality=this.quality/100),this.clearElement&&this.hideClear&&(this.clearElement.dataset.originalDisplay=this.clearElement.style.display?this.clearElement.style.display:"block",this.clearElement.style.display="none"),this.previewElement&&this.previewElement.getAttribute("src")&&this.showPreview(),this.inputElement.addEventListener("change",this),this.clearElement&&this.clearElement.addEventListener("click",this),this.webcamElement&&this.webcamElement.addEventListener("click",this),["dragleave","dragover","drop"].forEach(i=>this.holderElement.addEventListener(i,this)),this.holderElement.classList.add(U)}dispose(){this.inputElement.removeEventListener("change",this),this.clearElement&&this.clearElement.removeEventListener("click",this),this.webcamElement&&this.webcamElement.addEventListener("click",this),["dragleave","dragover","drop"].forEach(e=>this.holderElement.removeEventListener(e,this))}static init(e="input[type=file]"){let t=document.querySelectorAll(e);for(let i=0;i<t.length;i++){let r=t[i],l=new s(r)}}handleEvent(e){this["$".concat(e.type)](e)}$change(e){this.processFiles(()=>{this.showPreview()})}$click(e){let t=e.target.closest("button");t&&(t.classList.contains(_)&&this.clearPreview(),t.classList.contains(b)&&this.takePicture())}$drop(e){e.stopPropagation(),e.preventDefault(),this.inputElement.files=e.dataTransfer.files,this.inputElement.dispatchEvent(new Event("change")),this.holderElement.classList.remove(v)}$dragover(e){e.stopPropagation(),e.preventDefault(),this.holderElement.classList.contains(v)||this.holderElement.classList.add(v),e.dataTransfer.dropEffect="copy"}$dragleave(e){e.stopPropagation(),e.preventDefault(),this.holderElement.classList.remove(v)}showPreview(){if(!this.previewElement)return;this.holderElement.classList.add(H),this.clearElement&&this.clearElement.dataset.originalDisplay&&(this.clearElement.style.display=this.clearElement.dataset.originalDisplay);let e=this.previewElement.parentElement;for(let t=0;t<this.inputElement.files.length;t++){let i=this.inputElement.files[t];if(!i.type.match(/image.*/))continue;let r=e.querySelectorAll("."+I)[t];r||(r=this.previewElement.cloneNode(!0),r.classList.add(T),e.appendChild(r)),r.src=URL.createObjectURL(i)}}clearPreview(){if(this.previewElement){this.holderElement.classList.remove(H),this.previewElement.removeAttribute("src"),this.hideClear&&(this.clearElement.style.display="none");let e=this.holderElement.querySelectorAll("."+T);for(let t=0;t<e.length;t++)e[t].parentElement.removeChild(e[t])}this.inputElement.value=null}takePicture(){let e=document.createElement("video");navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(i=>{e.srcObject=i}).catch(i=>{console.error("An error occurred: ".concat(i))});let t=i=>{e.play();let r=.8,l=e.videoWidth,n=e.videoHeight,c=l,p=n,m=l/n,a=this.getTargetRatio()||m;l*=r,n*=r,m>a?l=n*a:m<a&&(n=l/a);let o=(c-l)/2,w=(p-n)/2,h=document.createElement("canvas"),d=h.getContext("2d");h.width=l,h.height=n,d.drawImage(e,o,w,l,n,0,0,l,n),d.canvas.toBlob(f=>{this.createProcessedFile({type:"image/jpg",name:"webcam"},f,()=>{this.showPreview(),e.removeEventListener("canplay",t,!1),e.srcObject.getTracks().forEach(u=>u.stop()),e.remove()})},"image/jpg",this.quality)};e.addEventListener("canplay",t,!1)}resizeImage(e,t,i){let r=t.naturalWidth||t.width,l=t.naturalHeight||t.height,n=0,c=0,p=r,m=l,a=r,o=l,w=a>this.maxWidth||o>this.maxHeight,h=a/o,d=this.getTargetRatio()||h,f=h!==d;if(!w&&!f){i();return}f&&(h>d?a=o*d:h<d&&(o=a/d),n=(r-a)/2,c=(l-o)/2),a>this.maxWidth&&(p*=this.maxWidth/a,m*=this.maxWidth/a,o*=this.maxWidth/a,a=this.maxWidth),o>this.maxHeight&&(p*=this.maxHeight/o,m*=this.maxHeight/o,a*=this.maxHeight/o,o=this.maxHeight),a=Math.round(a),o=Math.round(o);let u=document.createElement("canvas");u.width=a,u.height=o;let E=u.getContext("2d");E.imageSmoothingEnabled=!0,E.imageSmoothingQuality="high",f?E.drawImage(t,n,c,r,l,0,0,p,m):E.drawImage(t,0,0,a,o),E.canvas.toBlob(F=>{this.createProcessedFile(e,F,i)},e.type,this.quality)}getTargetRatio(){return this.imageRatio?parseInt(this.imageRatio[0])/parseInt(this.imageRatio[1]):0}handleResizeImage(e,t){if(!e.type.match(/image.*/)){t();return}if(this.disableResize){t();return}let i=new FileReader;i.onload=r=>{let l=new Image;l.onload=()=>{this.resizeImage(e,l,t)},l.onerror=n=>{},l.src=r.target.result},i.onerror=r=>{console.log(r)},i.readAsDataURL(e)}createProcessedFile(e,t,i){let r=new File([t],e.name,{type:e.type,lastModified:Date.now()}),l=new DataTransfer;for(let n=0;n<this.inputElement.files.length;n++){let c=this.inputElement.files[n];c.name===e.name?l.items.add(r):l.items.add(c)}e.lastModified||l.items.add(r),this.inputElement.files=l.files,i()}processFiles(e){let t=this.inputElement.files;if(!t.length){e();return}for(let i=0;i<t.length;i++)this.handleResizeImage(t[i],e)}},P=y;var L=s=>typeof s=="string";var g=s=>s.split(".").reduce((e,t)=>e[t],window);var W=s=>{L(s)&&(s=s[0]==="{"?JSON.parse(s):g(s));for(let[e,t]of Object.entries(s))if(t&&typeof t=="object"){let i=t.__fn;L(i)?s[e]=g(i):W(t)}return s},q=W;var D=s=>s?(s[0]!=="{"&&s.includes(":")&&(s="{".concat(s.replace(/([^:\s{,]*)\s*:\s*('[^']*'|"[^"]*"|([\[].*?[\]])|[^,'"{\[]*)/g,(e,t,i)=>'"'.concat(t.replace(/['"]/g,""),'":').concat(i.includes('"')?i:i.replace(/'/g,'"'))),"}")),s[0]==="{"?JSON.parse(s):g(s)):{};var B=s=>{let e=s;do{if(e.nextSibling){s.parsedCallback();return}e=e.parentNode}while(e);setTimeout(()=>{s.parsedCallback()})},M=B;var C="__fe_id";window[C]=window[C]||0;var x=new Map,S=class extends HTMLElement{_restoreContent(){this.id=this.id||"fe-".concat(window[C]++);let e=x.get(this.id);e?e!==this.innerHTML&&(this.innerHTML=e):x.set(this.id,this.innerHTML)}connectedCallback(){this._t&&clearTimeout(this._t),M(this)}disconnectedCallback(){this.disconnected(),this._t=setTimeout(()=>{this.destroyed(),this.config=null,document.getElementById(this.id)||x.delete(this.id)},1e3)}parsedCallback(){this.config||(this._restoreContent(),this.config=q(D(this.dataset.config)),this.created()),this.connected()}created(){}destroyed(){}connected(){}disconnected(){}},k=S;var A=class extends k{get el(){return this.querySelector("input")}created(){let e=this.el;this.superfile=new P(e)}destroyed(){this.superfile.dispose(),this.superfile=null}},R=A;var $=customElements,z=(s,e)=>{$.get(s)||$.define(s,e)};z("superfile-input",R);var he=R;})();
