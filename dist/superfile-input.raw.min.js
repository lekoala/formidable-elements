"use strict";(()=>{var F="superfile",A="superfile-preview",R="superfile-preview-active",I="superfile-clear",b="superfile-webcam",O="superfile-ready",v="superfile-drag",H="superfile-clone";var y=class i{constructor(e){this.inputElement=e,this.holderElement=e.parentElement,this.holderElement.classList.contains(F)||(this.holderElement=this.holderElement.parentElement),this.previewElement=this.holderElement.querySelector("img."+A),this.clearElement=this.holderElement.querySelector("."+I),this.webcamElement=this.holderElement.querySelector("."+b);let t=e.dataset;this.disableResize=!!t.disableResize,this.maxWidth=t.maxWidth?parseInt(t.maxWidth):1920,this.maxHeight=t.maxHeight?parseInt(t.maxHeight):1920,this.hideClear=!!t.hideClear,this.imageRatio=t.ratio?t.ratio.split(/\/|:/):null,this.quality=t.quality?parseInt(t.quality):1,this.quality>1&&(this.quality=this.quality/100),this.clearElement&&this.hideClear&&(this.clearElement.dataset.originalDisplay=this.clearElement.style.display?this.clearElement.style.display:"block",this.clearElement.style.display="none"),this.previewElement&&this.previewElement.getAttribute("src")&&this.showPreview(),this.inputElement.addEventListener("change",this),this.clearElement&&this.clearElement.addEventListener("click",this),this.webcamElement&&this.webcamElement.addEventListener("click",this),["dragleave","dragover","drop"].forEach(s=>this.holderElement.addEventListener(s,this)),this.holderElement.classList.add(O)}dispose(){this.inputElement.removeEventListener("change",this),this.clearElement&&this.clearElement.removeEventListener("click",this),this.webcamElement&&this.webcamElement.addEventListener("click",this),["dragleave","dragover","drop"].forEach(e=>this.holderElement.removeEventListener(e,this))}static init(e="input[type=file]"){let t=document.querySelectorAll(e);for(let s=0;s<t.length;s++){let r=t[s],l=new i(r)}}handleEvent(e){this[`$${e.type}`](e)}$change(e){this.processFiles(()=>{this.showPreview()})}$click(e){let t=e.target.closest("button");t&&(t.classList.contains(I)&&this.clearPreview(),t.classList.contains(b)&&this.takePicture())}$drop(e){e.stopPropagation(),e.preventDefault(),this.inputElement.files=e.dataTransfer.files,this.inputElement.dispatchEvent(new Event("change")),this.holderElement.classList.remove(v)}$dragover(e){e.stopPropagation(),e.preventDefault(),this.holderElement.classList.contains(v)||this.holderElement.classList.add(v),e.dataTransfer.dropEffect="copy"}$dragleave(e){e.stopPropagation(),e.preventDefault(),this.holderElement.classList.remove(v)}showPreview(){if(!this.previewElement)return;this.holderElement.classList.add(R),this.clearElement&&this.clearElement.dataset.originalDisplay&&(this.clearElement.style.display=this.clearElement.dataset.originalDisplay);let e=this.previewElement.parentElement;for(let t=0;t<this.inputElement.files.length;t++){let s=this.inputElement.files[t];if(!s.type.match(/image.*/))continue;let r=e.querySelectorAll("."+A)[t];r||(r=this.previewElement.cloneNode(!0),r.classList.add(H),e.appendChild(r)),r.src=URL.createObjectURL(s)}}clearPreview(){if(this.previewElement){this.holderElement.classList.remove(R),this.previewElement.removeAttribute("src"),this.hideClear&&(this.clearElement.style.display="none");let e=this.holderElement.querySelectorAll("."+H);for(let t=0;t<e.length;t++)e[t].parentElement.removeChild(e[t])}this.inputElement.value=null}takePicture(){let e=document.createElement("video");navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(s=>{e.srcObject=s}).catch(s=>{console.error(`An error occurred: ${s}`)});let t=s=>{e.play();let r=.8,l=e.videoWidth,n=e.videoHeight,d=l,p=n,m=l/n,a=this.getTargetRatio()||m;l*=r,n*=r,m>a?l=n*a:m<a&&(n=l/a);let o=(d-l)/2,w=(p-n)/2,h=document.createElement("canvas"),c=h.getContext("2d");h.width=l,h.height=n,c.drawImage(e,o,w,l,n,0,0,l,n),c.canvas.toBlob(f=>{this.createProcessedFile({type:"image/jpg",name:"webcam"},f,()=>{this.showPreview(),e.removeEventListener("canplay",t,!1),e.srcObject.getTracks().forEach(u=>u.stop()),e.remove()})},"image/jpg",this.quality)};e.addEventListener("canplay",t,!1)}resizeImage(e,t,s){let r=t.naturalWidth||t.width,l=t.naturalHeight||t.height,n=0,d=0,p=r,m=l,a=r,o=l,w=a>this.maxWidth||o>this.maxHeight,h=a/o,c=this.getTargetRatio()||h,f=h!==c;if(!w&&!f){s();return}f&&(h>c?a=o*c:h<c&&(o=a/c),n=(r-a)/2,d=(l-o)/2),a>this.maxWidth&&(p*=this.maxWidth/a,m*=this.maxWidth/a,o*=this.maxWidth/a,a=this.maxWidth),o>this.maxHeight&&(p*=this.maxHeight/o,m*=this.maxHeight/o,a*=this.maxHeight/o,o=this.maxHeight),a=Math.round(a),o=Math.round(o);let u=document.createElement("canvas");u.width=a,u.height=o;let E=u.getContext("2d");E.imageSmoothingEnabled=!0,E.imageSmoothingQuality="high",f?E.drawImage(t,n,d,r,l,0,0,p,m):E.drawImage(t,0,0,a,o),E.canvas.toBlob(z=>{this.createProcessedFile(e,z,s)},e.type,this.quality)}getTargetRatio(){return this.imageRatio?parseInt(this.imageRatio[0])/parseInt(this.imageRatio[1]):0}handleResizeImage(e,t){if(!e.type.match(/image.*/)){t();return}if(this.disableResize){t();return}let s=new FileReader;s.onload=r=>{let l=new Image;l.onload=()=>{this.resizeImage(e,l,t)},l.onerror=n=>{},l.src=r.target.result},s.onerror=r=>{console.log(r)},s.readAsDataURL(e)}createProcessedFile(e,t,s){let r=new File([t],e.name,{type:e.type,lastModified:Date.now()}),l=new DataTransfer;for(let n=0;n<this.inputElement.files.length;n++){let d=this.inputElement.files[n];d.name===e.name?l.items.add(r):l.items.add(d)}e.lastModified||l.items.add(r),this.inputElement.files=l.files,s()}processFiles(e){let t=this.inputElement.files;if(!t.length){e();return}for(let s=0;s<t.length;s++)this.handleResizeImage(t[s],e)}},P=y;var x=i=>typeof i=="string";var g=i=>i.split(".").reduce((e,t)=>e[t],window);var T=i=>{x(i)&&(i=i[0]=="{"?JSON.parse(i):g(i));for(let[e,t]of Object.entries(i))if(t&&typeof t=="object"){let s=t.__fn;x(s)?i[e]=g(s):T(t)}return i},W=T;var _=i=>i?(i.includes(":")&&i[0]!="{"&&(i=`{${i.replace(/([\w]*)\s*:\s*([\w"'\[\]]*)/,(e,t,s)=>`"${t}":${s.replace(/'/g,'"')}`)}}`),i[0]=="{"?JSON.parse(i):g(i)):{};var q=i=>{let e=i;do{if(e.nextSibling){i.parsedCallback();return}e=e.parentNode}while(e);setTimeout(()=>{q(i)})},D=q;var L=class extends HTMLElement{connectedCallback(){this._t&&clearTimeout(this._t),D(this)}disconnectedCallback(){this.disconnected(),this._t=setTimeout(()=>{this.destroyed(),this.config=null},1e3)}parsedCallback(){this.config||(this.config=W(_(this.dataset.config)),this.created()),this.connected()}created(){}destroyed(){}connected(){}disconnected(){}},k=L;var S=class extends k{get el(){return this.querySelector("input")}created(){let e=this.el;this.superfile=new P(e)}destroyed(){this.superfile.dispose(),this.superfile=null}},C=S;var M=customElements,$=(i,e)=>{M.get(i)||M.define(i,e)};$("superfile-input",C);var ne=C;})();
